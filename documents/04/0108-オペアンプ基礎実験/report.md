---
header-includes:
# - \usepackage{listings}
metadata:
  reportInfo:
    subject: オペアンプ基礎実験
    reportNo: 8
  writer:
    class: E4
    no: 14
    group: 2
    chief:
    name: 小畠 一泰
  others:
    date: 2020. 08. 06
    weather: 晴れ
    temp: 29.5
    wet: 54.0
  partners:
    collaborator1: 井上　隆治
    collaborator2: 重見　達也
    collaborator3: 宮崎　拓也
    collaborator4: 森　　和哉
---

# 目的

各種増幅回路, アナログ信号演算, アクティブ・フィルタなどに広く用いられるオペアンプの, 基本的な回路構成, 動作理論を理解することを目的として, オペアンプを用いた演算回路, フィルタ回路の動作検証実験を行う.

# 理論

## 理想オペアンプ

オペアンプと呼ばれる IC は, 単なる増幅器でなく, アナログ信号演算を行う「アナログ・コンピュータ」の基本素子として考察された演算増幅器である.
理想オペアンプは, 次の様な特性をもつものとして考えられている.

1. 入力インピーダンス $\infty$
1. 出力インピーダンス 0
1. 電圧利得 $\infty$
1. 帯域幅 f=0(直流) ～ $\infty$[Hz]
1. 入力オフセット電圧 0(出力電圧を 0 を出力するための誤差電圧)
1. 入力バイアス電流 0(入力端子をアクティブ状態とするために必要な電流)

実際のオペアンプは, 理想オペアンプに特性を近づけるべく設計されているが, 現実的には上記の特性をみたしておらず, 補償回路を付けるなどの回路修正や重要視する性能に秀でた機種の選択で対応する.

![オペアンプの回路記号](./documents/04/08-オペアンプ基礎実験/images/opamp.png){#fig:opamp height=30mm}

## 現実のオペアンプ

次に今回使用するオペアンプについて紹介する.
ST Microelectronics 社製 UA741 は, 位相補償回路が内蔵された汎用オペアンプである.
[@fig:UA741] に外観および端子配置を示す.

端子配置を見ると分かる様に, まずオフセット調整端子が見受けられる.
これは, 理想オペアンプでは 0 となるはずのオフセット電圧が発生することを示し, 応用上必要があれば指定の半固定抵抗を接続して調整する.
他にも電圧利得が約 100dB < $\infty$, 帯域幅が約 1MHz であるなど, 理想オペアンプとは多々違いがある.
ただ, いずれの製品でも理想オペアンプの性能とはかけ離れており, オペアンプの応用には, 理想オペアンプとの違いを理解して適切に対処する(補償回路などを設ける)ことが不可欠となる.

![供試オペアンプUA741の端子配置](./documents/04/08-オペアンプ基礎実験/images/UA741.png){#fig:UA741 width=90mm}

## 反転増幅回路

反転増幅回路とは, 入力信号に対して極性が逆となるように増幅する回路で, 交流信号であれば位相が反転して増幅される.
[@fig:image4] に, 基本的に反転増幅回路を示し, これを用いて原理を説明する.

反転増幅回路は, 反転入力端子に直列抵抗 $R_s$ を通して入力を加え, 出力端子から反転入力端子にはフィードバック抵抗 $R_f$ を通して負帰還がかかる様に接続される.
また, 非反転入力素子は接地点(アース)に接続される.
入力電圧 $V_i$ により, 入力電流 $I_s$ が $R_s$ を通って反転入力端子に流れ込むが, オペアンプの入力インピーダンスは理論的には $\infty$ であるから, オペアンプに流れ込むことなく $R_f$ をとおり出力端子に流れる.
このため, $I_s=I_f$ となることから
$$I_s=\frac{V_i-V_n}{R_s}=\frac{V_n-V_o}{R_f}$$
となる.
ここで, オペアンプは基本的に差動増幅器であるから, その電圧増幅率を A_0 とすると
$V_0=A_0 \cdot (Vp-Vn)$
$V_n=V_p-\frac{V_0}{A_0}$
となる.
ここで, オペアンプの閉ループ電圧増幅率(オープンループゲイン) $A_0=\infty$ となるから
$$V_n=V_p$$
と見なせる.
つまり, オペアンプは入力端子間の電位差はなくなるように動作し, 仮想的に短絡していると考えられる.
これをヴァーチャルショートと呼び, この場合 $V_p$ が接地電位であるためヴァーチャルグランド(仮想接地)と呼ぶ.
$V_n=0$ であるから, $I_s$ の式を変形して
$$V_0=\frac{R_f}{R_s} \cdot V_i$$
となり, 反転増幅回路の電圧増幅率 $A_V$ は下式となり, 極性または位相が反転する負となる.

$$A_V=\frac{R_f}{R_s}$$

![反転増幅回路の原理](./documents/04/08-オペアンプ基礎実験/images/image4.png){#fig:image4 height=50mm}

![実際の反転増幅回路](./documents/04/08-オペアンプ基礎実験/images/image5.png){#fig:image5 height=50mm}

![増幅回路の周波数特性](./documents/04/08-オペアンプ基礎実験/images/image6.jpeg){#fig:image6 height=50mm}

[@fig:image5] に現実的な反転増幅回路の一例と[@fig:image6]電圧利得の周波数特性を示す.
この回路ではフィードバック抵抗$R_f$と並列に, コンデンサ$C_f$が接続される.
また非反転入力端子には, $R_{s2}=R_s//R_f$となる接地抵抗が接続される.
コンデンサ $C_f$ は, 周波数特性図中のオープンループゲイン減衰付近では不安定領域(ノイズ, 不作為な発振等が発生)となるため, より低い周波数で安定的に利得を減衰させるなどの意味がある.
カットオフ周波数は$f_c=1/(2\pi R_fC_f)$となる.
一方, 接地抵抗$R{s2}$はバイアス電流の影響を抑制する.
理想的には 0 であるはずであるが, 現実的には入力端子にはバイアス電流が必要であり, 反転入力端子のバイアス電流は$R_s$と$R_f$に流れる.
非反転増幅入力端子が直接接地する場合, バイアス電流により両端子間に電位差$(R_s//R_f)I_B$が発生する.
そこで, 非反転入力端子に$R_{s2}$を接続することで, バイアス電流による影響を等しくして出力への影響をキャンセルする.

\clearpage

## 非反転増幅回路

[@fig:image7] に, 基本的な非反転増幅回路を示す.
図に示すように, 入力信号は非反転入力端子に直接接続され, 反転入力端子には出力端子からフィードバック抵抗 $R_f$ を通じて接地される.
ここで, フィードバック電流 $I_f$ は, オペアンプの入力インピーダンスが $\infty$ に近いため反転入力端子に流れ込むことはなく, $I_s=I_f$ となる.
したがって, 反転入力端子の電位 $V_n$ は $R_f, R_s$ で分圧された出力電圧
$$V_n=\frac{R_s}{R_f+R_s} \cdot V_o$$
となる.
ここで, ヴァーチャルショートにより $V_i=V_p=V_n$ となるため, 出力電圧 $V_o$ は
$$V_n=\frac{R_f+R_s}{R_s} \cdot V_i$$
となる.
よって, 非反転増幅回路の電圧増幅率 $A_v$ は
$$A_v=\frac{R_f+R_s}{R_s}=1+\frac{R_f}{R_s}$$
となって $A_v>0$ となり, 極性は変わらず（位相は同相で）増幅されることを示す.
非反転増幅回路は, 入力端子をそのまま使用するため回路全体で見た入力インピーダンスが非常に高く, 出力インピーダンスが高い信号源でも増幅率を低下させることはない.

![非反転増幅回路の原理](./documents/04/08-オペアンプ基礎実験/images/image7.png){#fig:image7 height=50mm}

## 加算回路

複数の入力電圧を加えて出力する場合, [@fig:image8] に示すような加算回路を用いる.
入力信号として$V_1,V_2,V_3$(対接地電位)を, 反転入力端子につながる各入力端子に加えるものとする.
すると, 各直列抵抗$R_{s1}～R_{s3}$に流れる電流$I_1～I_3$は
$$I_1=\frac{V_1}{R_{s1}}, I_2=\frac{V_2}{R_{s2}}, I_3=\frac{V_3}{R_{s3}}$$
となる.
これらは反転入力端子にすべて流れ込むが, 入力インピーダンスが $\infty$ のためすべてが
フィードバック電流$I_f$となる.
$V_n$はヴァーチャルグランドのため 0 電位であり, 出力電圧$V_o$は
$$V_o=-R_f \cdot I_f=-R_f \cdot (V_1 R_{s1}+V_2 R_{s2}+V_3 R_{s3})$$
となる.
ここで$R_{s1}～R_{s3}$を等しい抵抗値 R に選ぶと出力電圧$V_o$は
$$V_o=-\frac{R_f}{R} \cdot (V_1+V_2+V_3)$$
となり, 入力信号の総和に比例する出力となる.
なお, 入力端子は出力電圧が緩和しない限り, 増設することが可能である.

![加算回路の原理](./documents/04/08-オペアンプ基礎実験/images/image8.png){#fig:image8 height=50mm}

## 差動増幅回路

差動増幅回路とは, 2 点間の電位差のみを増幅する回路であるが, オペアンプも基本的には差動増幅回路ではあるものの増幅率が大きすぎるため, そのままでは使用できない.
図８に, 基本的な差動増幅回路を示す.
ここでは, 簡単化のために$R_1, R_2$の二種類の抵抗値で構成している.

この回路でもヴァーチャルショートのため, $V_n = V_p$となるように働き
$$V_n=V_1-R_1I_1=R_2I_2=V_p$$
が成立する.
やはり, 入力インピーダンスが$\infty$のため入力端子に流れ込むことはなく, それぞれ
$$I_1=\frac{V_1-V_0}{R_1+R_2}, I_2=\frac{V_2}{R_1+R_2}$$
となる.
ここで各電流の式を代入して出力電圧$V_o$にまとめると,
$$V_o=-\frac{R_2}{R_1}\cdot(V_1-V_2)$$
と表すことができ, 入力端子間電圧を反転増幅していることが分かる.

![差動増幅回路の原理](./documents/04/08-オペアンプ基礎実験/images/image8.png){#fig:image8 height=50mm}

## 積分回路(LPF)

反転増幅回路のフィードバック抵抗$R_f$を, コンデンサ$C_f$で置換したものが積分回路の基本形である.
その回路図を [@fig:image9] に示す.
入力端子から流れ込んだ Is は, すべて$C_f$に流れ込む.
このため出力電圧$V_o$は,
$$V_o=-\frac{1}{C_f}\int{I_sdt}$$
と表せる.
つまり, 入力電流$I_s$を積分したものとなり, 反転入力端子はヴァーチャルグランドとして電位 0 と考えてよいから
$$I_s=\frac{V_i}{R_s}$$
$$V_o=-\frac{1}{R_sC_f}\int{V_idt}$$
となり, 入力電圧$V_i$を積分した値に比例した電圧を入力することになる.

しかし基本回路だけでは, オフセット電圧などの微弱な直流成分でさえも際限なく積分していき, 最終的には必ず出力電圧が飽和してしまう.
通常, 積分するときの信号の周波数帯域は限定されているので, その帯域だけで積分動作を行い, 不必要な低域はその利得を限定するのが望ましい.

[@fig:image10] に積分回路の周波数特性を示す.

![積分回路の原理](./documents/04/08-オペアンプ基礎実験/images/image9.png){#fig:image9 height=50mm}

![積分回路の周波数特性](./documents/04/08-オペアンプ基礎実験/images/image10.jpeg){#fig:image10 height=50mm}

[@fig:image9] の回路では, ほぼ理想積分器の特性を示し, 周波数の低下と共に利得が上昇していく.
理想的には $\infty$ となるが, 実際にはオープンループゲイン $A_o$ の最大値で飽和する.
しかし, その利得でも十分に大きすぎる上に不安定になりやすく, 容易く出力電圧は飽和してしまう.
[@fig:image11] に, 現実的な積分回路を示す.
この回路は, 回路図としては [@fig:image5] の反転増幅回路と同じである.
積分動作をするのは, カットオフ周波数 $f_c$ より高い周波数の領域であり, この範囲を広くするには $R_f$ を増加させて低域利得を上げ, $f_c$ を下げるしかない.
積分回路として用いる場合, オフセット電圧などの影響の出ない範囲で低域利得を上げていることが多い.

![実際の積分回路ローパスフィルタ回路](./documents/04/08-オペアンプ基礎実験/images/image11.png){#fig:image11 height=50mm}

ここで, 見方を変えるとカットオフ周波数 $f_c$ より低域を通過させることから, 1 次の低域通過型アクティブ・フィルタとしてみることもできる.
次数を上げる場合には, 主に $R_s$ より前段に受動型(パッシブ)フィルタを追加する方法がよく用いられる.

## 微分回路(HPF)

微分回路の場合には反転増幅回路に対して, 積分回路とは逆に直列抵抗 $R_s$ とコンデンサ $C_s$ とを交換したものが, 基本的な回路となる.
それを [@fig:image12] に示す.

![微分回路の原理](./documents/04/08-オペアンプ基礎実験/images/image12.JPG){#fig:image12 height=50mm}

この回路でも, 反転入力端子はヴァーチャルグランドのため電位 0 となり, コンデンサ $C_s$ を流れる電流は入力電力 $V_i$ の時間変化に比例する.
つまり入力電流 $I_s$ は,
$$I_s=Cs \cdot \frac{dV_i}{dt}$$
となる.
また, この電流は反転入力端子には流れ込むことは無く, すべてフィードバック抵抗 $R_i$ に流れることから, 出力電圧 $V_o$ は
$$Vo=-R_f \cdot I_s = -R_f \cdot C_s \cdot \frac{dV_i}{dt}$$
となる.
この式から, $V_i=e^{j\omega t}$として交流利得を考えると, 周波数に比例する式となる.
この様子を, [@fig:image13] に微分回路の周波数特性を示した中で見ると, 理想微分器の特性(斜め破線)となる.

![微分回路の周波数特性](./documents/04/08-オペアンプ基礎実験/images/image13.jpg){#fig:image13 height=50mm}

しかし, [@fig:image12] 回路のオペアンプは実際のものと考えると, この回路の周波数特性は一点鎖線の様になる.
この状態で使用した場合, 高周波のノイズが発生しやすく, オープンループゲイン特性の不安定性が出現したり, 出力端子から見た帰還回路が積分回路となっているため位相ずれにより発振状態になることも考えられる.

![実際の微分回路ハイパスフィルタ回路](./documents/04/08-オペアンプ基礎実験/images/image14.jpg){#fig:image14 height=50mm}

このため, 通常では図 [@fig:image14] の回路にて使用する.
直列抵抗 $R_s$ が入るため利得は下がるものの, 実際には安定性は上げる.
微分回路として動作するのは, $f_{cz}$ 以下の周波数帯域となる.
また, Cf が入ることで不安定な領域となるオープンループゲインよりも低い周波数 $f_c$ でカットオフでき, 安定的な動作が可能となる.

積分回路と同様に, 別の見方をするとカットオフ周波数 $f_{cz}$ となる.
1 次広域通過型アクティブフィルタとして見ることができる.
ハイパスフィルタとして用いる場合も, 不安定な高域は $C_f$ にてカットオフするのが通例である.
次数を上げる場合, 積分回路と同様に前段にパッシブフィルタを挿入する.

\clearpage

# 実験機器

- オペアンプ UA741
- Analog Discovery
- ディジタルテスタ(DMM)
- ブレッドボード
- AD 用ケーブルセット
- ブレッドボードケーブル
- フレキシブルケーブル
- グラバクリップケーブル
- $10 \unit{k \ohm}$ 半固定抵抗器
- $200 \unit{\ohm}$ 半固定抵抗器
- 抵抗器(1k, 10k)
- コンデンサ(180p, 1500p, 0.1$\micro$)

# 実験方法と実験結果

## 実験の前に

実験には Analog Discovery という USB 計測器を使用するため, ノート PC に USB ケーブルにて接続し, 認識させた.
その後, ブレッドボードに両電源用基板を直接取り付けた.
ブレッドボードの 60 番ソケット側に差し込み, 配線参照図の図 0-1 を参照して, オペアンプ, 電源配線, バイパスコンデンサ(0.1$\micro F$ 積層セラミックコンデンサ)の順で配線した.

## オフセット電圧調整

<!-- TODO: inject Fig.15 -->

1. 図 15 にオフセット調整付き反転増幅回路の回路図を示す.
   配線参照図の図 1-1, 図 1-2 を参照して, オフセット調整回路, 反転増幅回路の配線を完成させた.
   その状態で, 電圧利得 $20 \unit{\si{\decibel}}(A_v=10)$の反転増幅回路となるはずである.

1. このままで入力 0V の反転増幅回路となっている.
   オフセット調整用半固定抵抗器($10 k \ohm VR$)を一旦抜いてから, 出力電圧 $V_o$ を DMM にて測定して初期オフセット電圧 $10 \times V_{off1}$ を記録した.
   その後, $10 k \ohm VR$ を所定位置に差し込んで調整し, $V_o$ を極力 $0\unit{V}$に近づけた.
   そのときの $V_o$ の値を, 調整後オフセット電圧 $10 \times V_{off2}$ として記録した.
   <!-- TODO: replace real table for UA741 Datasheet -->
   $10 \times V_{off1}$ がオペアンプの定格範囲内 (表 1 中 V*io 最大値以下)にあることを確認し, また \$V*{off2}\$ が測定に影響ない値であることを実験終了後に確認する.

## 加算回路

<!-- TODO: inject Fig.16 -->

1. 図 16 に加算回路の回路図を示す.
   電源およびオフセット回路は省略されているが, 接続したままで使うものとし, 調整用の $10 k \ohm VR$ などは変えない.
   配線参照図の図 2-1 を参照し, 配線を行った.
   Analog Discovery ケーブルの AWG1, Scope Ch1, Ch2 のマイナス側は, すべてブレッドボードの GND に接続した.

1. Analog Discovery 簡易マニュアル(以下, 簡易マニュアルとする)を参照し, WaveGen, Scope を Waveforms ランチャーから起動し, 両電源用基板の電源スイッチを閉(on)にした.

1. $V_{i1}$ を +500mV, 0mV, -500mV の 3 とおりについて, $V_{i2}$ を変化させて加算動作を確認した.
   <!-- TODO: inject Fig.16 -->

   図 16 左端の $V_{i1}$ 側フレキシブル配線を +15V ラインに接続し, また $V_{i2}$ は三角波, 100Hz, 2Vpp に設定した WaveGen の出力 AWG1 を $V_{i2}$ 端子に直接接続した.
   $V_{i1}$ の $200 \ohm VR$ を DMM で見ながら調整して $V_{i1}=+500mV$ とした.
   次に $V_{i1}, V_o$ 端子に Scope の入力 Ch1+, CH2+を接続した.

1. WaveGen および Scope の両方で「Run」ボタンをクリックし, Scope 画面上に $V_{i2}, V_o$ 波形を約 2 周期分程度に表示する様に調整した.
   その後, Scope の「Stop」ボタンをクリックして動作を停止させ, その状態で簡易マニュアルを参照して X-Y 画面の画像データ(png 形式)と text データ(csv 形式)の両方を取得保存した.

1. $V_{i1}$ のフレキシブル配線を半固定抵抗器から GND に接続し, $V_{i1}=0mV$ として（3）と同様に測定した波形データを取得した.
   <!-- TODO: inject Fig.16 -->

   また, 図 16 中左端のフレキシブル配線を -15V ラインに接続し, $V_{i1}=-500mV$ に調整後に（3）と同様に測定と波形データ取得を行った.

1. 得られた波形データから, 3 とおりの $V_{i1}$ について入出力特性曲線を作成した.
   これにより, 加算回路が正しく動作できているか確認を行った.

   ![加算回路-入出力特性曲線](./documents/04/08-オペアンプ基礎実験/images/sum-input-output.png){#fig:sum-input-output height=80mm}

## 差動回路

<!-- TODO: inject Fig.17 -->

1.  図 17 に差動増幅回路の回路図を示す.
    両電源用基板の電源スイッチを一旦, 開(off)にして, 図 17 となるように回路配線を行った.

1.  電源スイッチを閉(on)とし, $V_{i1}$ を +500mV, 0mV, -500mV の 3 とおりについて, $V_{i2}$ を変化させて差動動作を確認した.
    加算回路（3）～（5）と同様に $V_{i2}, V_o$ 波形を Scope の入力 Ch1+, Ch2+ で測定し, X-Y 画面の画像データ(png 形式)と text データ(csv 形式)の両方を取得した.

1.  加算回路（6）と同様に得られた波形データから, 3 とおりの $V_{i1}$ について入出力特性曲線を作成した.
    これにより, 差動増幅回路が正しく動作できているか確認を行った.

    ![差動回路-入出力特性曲線](./documents/04/08-オペアンプ基礎実験/images/diff-input-output.png){#fig:diff-input-output height=80mm}

## 積分回路(ローパスフィルタ)

<!-- TODO: inject Fig.18 -->

1. 図 18 に積分回路(ローパスフィルタ)の回路図を示す.
   両電極用基板の電源スイッチを一旦, 開(off)にして, 図 18 となるように回路配線を行った.
   基本的には, 反転増幅回路の形ではあるが, フィードバックコンデンサ $C_f$ が変更されているので注意すること.
   また, 入力用半固定抵抗器は用いない.

1. 積分回路(ローパスフィルタ)の周波数特性曲線を作成した.
   まず, 原理 7 に従い, カットオフ周波数 $f_c$ を計算した.
   その後, Scope および WaveGen を一旦終了し, Wavefomes ランチャーの下側 "More Instruments" ボタンをクリックして Network Analyzer を起動してボード線図を解析した.
   周波数範囲は 10Hz ～ 10kHz とし, 取得点数は 20pt./Dec., 対数表示とした.
   ボード線図縦軸を利得側で 0 ～ 20dB, 位相側で -180 ～ +180deg にした.
   測定結果は画像データ(png 形式)と text データ(csv 形式)の両方を取得保存した.

1. カットオフ周波数 $f_c$ 前後での, 増幅率および位相変化を確認した.
   Network Analyzer を一旦終了し, Scope および WaveGen を起動して, WaveGen の出力を正弦波, 振幅 500mV とした.
   周波数特性から実測の $f_c$ (通過帯域利得 -3dB 点)を求め, 計算上の $f_c$ と比較した.
   また, ローパスフィルタとしての通過帯域中央付近の周波数, 実測の $f_c, f_c$ 以上の阻止帯域中央付近の周波数において, Scope で波形画像の取り込みを行い, 増幅率および位相差の確認を行った.
   さらに, 実測 $f_c$ 以下の周波数帯域でのローパス特性と, 実測 $f_c$ 以上の周波数帯域での積分動作について検証をした.
1. （3）の波形画像取り込みと同じ 3 つの周波数で, WaveGen の出力波形を方形波に変更して画像の取り込みを行った.
   （3）で取り込んだ画像と合わせて, 積分動作可能な周波数帯域について検証した.

$$f_c = \frac{1}{2\pi \times 0.1 \times 10^{-6} \times 10 \times 10^3} = 159.1550 Hz$$
$$A_v = -\frac{R_f}{R_s} = - \frac{10 \times 10^3}{1 \times 10^3} = -10$$
$$G_v = 20 log_{10}|Av| = 20 dB$$

![積分回路ボード線図](./documents/04/08-オペアンプ基礎実験/images/積分回路書き込み.png){#fig:filename height=70mm}

![積分回路 正弦波 遮断周波数](./documents/04/08-オペアンプ基礎実験/images/積分回路_正弦波_Fc.png){#fig:filename height=70mm}

![積分回路 正弦波 通過帯域中央付近](./documents/04/08-オペアンプ基礎実験/images/積分回路_正弦波_通過域.png){#fig:filename height=70mm}

![積分回路 正弦波 阻止帯域中央付近](./documents/04/08-オペアンプ基礎実験/images/積分回路_正弦波_阻止域.png){#fig:filename height=70mm}

![積分回路 方形波 遮断周波数](./documents/04/08-オペアンプ基礎実験/images/積分回路_方形波_Fc.png){#fig:filename height=70mm}

![積分回路 方形波 通過帯域中央付近](./documents/04/08-オペアンプ基礎実験/images/積分回路_方形波_通過域.png){#fig:filename height=70mm}

![積分回路 方形波 阻止帯域中央付近](./documents/04/08-オペアンプ基礎実験/images/積分回路_方形波_阻止域.png){#fig:filename height=70mm}

\clearpage

## 微分回路(ハイパスフィルタ)

1. 図 19 に微分回路(ハイパスフィルタ)の回路図を示す.
   両電源用基板の電源スイッチを一旦開(off)にして, 図 19 となるように回路配線を行った.
   基本的には, 反転増幅回路の形であるが, 直列コンデンサ $C_s$ が追加され, $C_f$ が変更されているので注意すること.

1. 微分回路(ハイパスフィルタ)の周波数特性曲線を作成した.
   まず, 原理 8 に従い, 3 つの周波数 $f_{cb}, f_{cz}, f_c$ を計算した.
   その後, 積分回路（2）と同様に一旦全 SFP を終了した後, SFP"Bode"を起動してボード線図を解析した.
   周波数範囲は 100Hz ～ 100kHz とし, 取得点数は 20pt./Dec., 対数表示とした.
   ボード線図縦軸を利得側で 0 ～ 20dB, 位相側で -180 ～ +180deg にした.
   測定結果は画像データ(png 形式)と text データ(csv 形式)の両方を取得保存した.

1. カットオフ周波数前後での, 増幅率および位相変化を確認した.
   周波数特性から実測の $f_{cz}$ (通過帯域利得 -3dB 点)を求め, 計算上の $f_{cz}$ と比較した.
   また, $f_{cb}, f_{cz}$ 間中央付近の周波数, 実測の $f_{cz}$, ハイパスフィルタとしての通過帯域中央付近の周波数において, 積分回路（3）と同様に波形画像の取り込みを行い, 増幅率および位相差の確認を行い, 実測 $f_{cz}$ 以上の周波数帯域でのハイパス特性と, 実測 $f_{cz}$ 以下の周波数帯域での微分動作について検証をした.

1. （3）の波形画像取り込みと同じ 3 つの周波数で, FGEN の出力波形を三角波および方形波に変更して画像の取り込みを行った.
   （3）で取り込んだ画像と合わせて, 微分動作可能な周波数帯域について検証した.

また各周波数は次のとおりである.

$$f_{cb} = 159.1550 Hz, f_{cz} = 1591.5494 Hz, f_c = 88419.4128 Hz$$

$$\frac{f_{cb}+f_{cz}}{2} = 875.3522 Hz, \frac{f_{cz}+f_{c}}{2} = 45005.4811 Hz$$

![微分回路 正弦波 Fcb-Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_正弦波_Fcb-Fcz.png){#fig:filename height=70mm}

![微分回路 正弦波 Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_正弦波_Fcz.png){#fig:filename height=70mm}

![微分回路 正弦波 Fcz-Fc](./documents/04/08-オペアンプ基礎実験/images/微分回路_正弦波_Fcz-Fc.png){#fig:filename height=70mm}

![微分回路 三角波 Fcb-Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_三角波_Fcb-Fcz.png){#fig:filename height=70mm}

![微分回路 三角波 Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_三角波_Fcz.png){#fig:filename height=70mm}

![微分回路 三角波 Fcz-Fc](./documents/04/08-オペアンプ基礎実験/images/微分回路_三角波_Fcz-Fc.png){#fig:filename height=70mm}

![微分回路 方形波 Fcb-Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_方形波_Fcb-Fcz.png){#fig:filename height=70mm}

![微分回路 方形波 Fcz](./documents/04/08-オペアンプ基礎実験/images/微分回路_方形波_Fcz.png){#fig:filename height=70mm}

![微分回路 方形波 Fcz-Fc](./documents/04/08-オペアンプ基礎実験/images/微分回路_方形波_Fcz-Fc.png){#fig:filename height=70mm}

\clearpage

# 考察および研究

1. オフセット電圧調整において測定したオフセット電圧以外にも, オペアンプによる精密測定に影響するパラメータとして, バイアス電流, 入力換算ノイズが挙げられる.
   それぞれについて説明し, どのような場合に問題となるか考察せよ.

   オペアンプが正しく動作するためには, 反転端子, 非反転端子それぞれに電流を流す, もしくは引き込む必要があります.
   この電流は入力バイアス電流, もしくは単に入力電流と呼ばれます.
   下図 Ib1, Ib2 がそれにあたります.

   ![入力バイアス電流](./documents/04/08-オペアンプ基礎実験/images/input-bias-current1.png){#fig:input-bias-current1 height=50mm}

   [@fig:input-bias-current1] のように入力バイアス電流が帰還抵抗を流れる事で, 出力にオフセット電圧を発生させる.
   そのオフセット電圧は [@fig:input-bias-current1] の回路において以下の式で算出できる.

   $$\Delta V = I_{b1} \times -R_f$$

   これより入力バイアス電流が大きいほど, バイアス電流により出力に表れるオフセット電圧が大きくなることが分かる.

   アンプは, 「自分自身がノイズを発生しない」というのが理想です.
   しかしながら, 必ずアンプはノイズを発生します.
   アンプ内の各所で発生するノイズが, すべてアンプの入力箇所で発生したものと仮定したノイズを「入力換算雑音」で表します.
   アンプの入力換算雑音レベルが信号入力レベル以上であれば, 信号はアンプ自身の発生するノイズに埋もれてしまいます.
   したがってアンプを組み合わせて増幅するときは, アンプ自身のノイズを考慮して, 初段には低雑音アンプ使用することが大切である.

1. オペアンプを使ったアナログフィルタとして, 今回実験を行なった一次フィルタ以外にバタワースフィルタ, チェビシェフフィルタと呼ばれる, 高次のアナログフィルタにも使われる.
   一次のローパス・フィルタと比較する形で, バタワースフィルタ, チェビシェフフィルタの周波数特性および特徴を調査し説明せよ.
   また, 高次のアナログフィルタとディジタルフィルタを比較して両者の特徴を説明せよ.

   一次のローパス・フィルタに比べ, バタワースフィルタは通過域のゲイン特性は平坦だが, 過渡域では急峻ではないフィルタである.
   またチェビシェフフィルタは通過域にリプルがあるが過渡域は急峻に減少し, 阻止域での減衰が大きいフィルタである.

   アナログフィルタはアナログ信号を直接処理するのに対し, デジタルフィルタは処理前にまずアナログ信号をデジタル信号に変換する必要がある.
   また処理後, 信号をデジタル信号からアナログ信号に再度変換する必要がある.
   アナログフィルタの構成を変えるには回路自体を変更する必要があるが, デジタルフィルタはアルゴリズムを書き直すだけなので容易に変更できる.
   デジタルフィルタは, アナログフィルタでは処理できない非常に低い周波数も処理できます.

1. 今回実験を行なったオペアンプの利用方法以外に, コンパレータおよび発振器として使用されている.
   それぞれの代表的な回路を調べてその動作を説明せよ.

   ふたつの入力端子の一方に基準となる電圧を接続して電圧を固定しておき, もう一方の入力端子に基準と比較する監視対象の電圧を入力して使用します.
   この状態で出力端子をモニターし, 監視 (比較) 対象の電圧が基準電圧(Vref)以上, あるいは以下になったことを検出するというものです.
   反転入力に基準電圧, 非反転入力に監視したい電圧を接続した場合, 次のような動作となります.
   監視したい電圧 (非反転入力) ＜ 基準電圧 (反転入力) → 出力端子は Low レベル
   監視したい電圧 (非反転入力) ＞ 基準電圧 (反転入力) → 出力端子は High レベル
   [@fig:opamp-comp] に反転入力を基準とした場合のコンパレーターの接続と動作イメージを示します.

   ![コンパレーターと動作イメージ](./documents/04/08-オペアンプ基礎実験/images/opamp-comp.png){#fig:opamp-comp height=50mm}

   ![発振回路の原理](./documents/04/08-オペアンプ基礎実験/images/eg.gif){#fig:eg height=50mm}

   発振回路は [@fig:eg] に示すように増幅器と帰還回路から構成されている.
   オペアンプは非反転入力端子の電圧$V_{IN}+$と反転入力端子の電圧$V_{IN}-$が等しくなるように制御を行っており, この時, 帰還回路の位相遅れが原因で出力電圧が発振してしまう.
   その発振を継続するには, 次式の条件を満たす必要がある.
   $V_{\beta}$ を帰還電圧, $V_I$ を入力電圧とすれば,

   $$V_{\beta} \geqq V_I$$

   また, 増幅回路の増幅度を A, 帰還回路の帰還率を $\beta$ とすれば,

   $$A \cdot \beta \geqq 1$$

   ここで A, $\beta$ にはリアクタンス分が含まれるので複素数になる.
   すなわち, 増幅度を $\dot{A}$, 帰還回路の帰還率を $\dot{\beta}$ となり,

   $$Re(\dot{A} \dot{\beta}) \geqq 1, Im(\dot{A} \dot{\beta}) = 0$$

   の 2 つの式が成立しなければならない.
   [@fig:wien-bridge] はウィーンブリッジ発振回路である.
   この図における振幅条件及び周波数条件（発振周波数）はそれぞれ次式で示される.

   $$振幅条件 = \frac{R_2}{R_1} = 2, 周波数条件 = f = \frac{1}{2 \pi R C}$$

   ![ウィーンブリッジ発振回路](./documents/04/08-オペアンプ基礎実験/images/wien-bridge.gif){#fig:wien-bridge.gif height=50mm}

# 参考文献

- 岡村廸夫「改訂 OP アンプ回路の設計」, CQ 出版(株)(1968)
- オペアンプ・コンパレーターの基礎 - Toshiba (https://toshiba.semicon-storage.com/info/docget.jsp?did=12710)
- オペアンプ（３）発振回路、微積分回路 - 公益社団法人 日本電気技術者協会 (https://jeea.or.jp/course/contents/12124/)
- オペアンプが発振する原理とは？ - Electrical Information (https://detail-infomation.com/operational-amplifier-oscillation/)
- オペアンプの入力バイアス電流、ちゃんとキャンセルできていますか？ | 組込み技術ラボ (https://lab.fujiele.co.jp/articles/5444/)
- アンプのノイズ|エヌエフ回路設計ブロック (http://www.nfcorp.co.jp/techinfo/keisoku/module/a_noise.html)
